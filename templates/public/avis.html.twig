{% extends 'base.html.twig' %}

{% block title %}Vos retours - TDBR{% endblock %}

{% block body %}
    <div class="min-h-screen bg-gradient-to-b from-gray-50 to-white py-12">
        <div class="container mx-auto px-4 max-w-4xl">

            {# Header #}
            <div class="text-center mb-12">
                <h1 class="font-heading text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 mb-4">
                    Vos retours
                </h1>
                <p class="text-lg text-gray-600 leading-relaxed max-w-2xl mx-auto">
                    Découvrez les témoignages de nos clients et partagez votre expérience avec TDBR.
                </p>
                <div class="mt-8">
                    {% if app.user %}
                        <a href="{{ path('avis_ajouter') }}" class="btn-primary px-8 py-4 text-base">
                            Laisser mon avis
                        </a>
                    {% else %}
                        <a href="{{ path('connexion', {redirect: '/vos-retours/ajouter'}) }}" class="btn-primary px-8 py-4 text-base">
                            Se connecter pour laisser un avis
                        </a>
                    {% endif %}
                </div>
            </div>

            {# Liste des avis #}
            {% if avisListe|length > 0 %}
                <div class="space-y-8">
                    {% for avis in avisListe %}
                        <div class="card p-6 md:p-8">
                            <div class="flex flex-col sm:flex-row gap-6">

                                {# Photo (si présente) #}
                                {% if avis.photoFilename %}
                                    <div class="flex-shrink-0">
                                        <img src="{{ asset('uploads/avis/' ~ avis.photoFilename) }}"
                                             alt="Photo de {{ avis.user.prenom }}"
                                             class="w-full sm:w-40 h-40 object-cover rounded-xl">
                                    </div>
                                {% endif %}

                                {# Contenu #}
                                <div class="flex-1 min-w-0">
                                    <div class="flex flex-wrap items-center gap-3 mb-3">
                                        {# Avatar initiales #}
                                        <div class="w-10 h-10 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0">
                                            {{ avis.user.prenom|first }}{{ avis.user.nom|first }}
                                        </div>
                                        <div>
                                            <div class="font-semibold text-gray-900">
                                                {{ avis.user.prenom }} {{ avis.user.nom }}
                                            </div>
                                            <div class="text-sm text-gray-500">
                                                {{ avis.createdAt|date('d/m/Y') }}
                                            </div>
                                        </div>

                                        {# Note étoiles #}
                                        {% if avis.note %}
                                            <div class="flex items-center gap-0.5 ml-auto">
                                                {% for i in 1..5 %}
                                                    <svg class="w-5 h-5 {{ i <= avis.note ? 'text-secondary' : 'text-gray-200' }}"
                                                         fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                                                    </svg>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>

                                    <p class="text-gray-700 leading-relaxed whitespace-pre-line">
                                        {{ avis.contenu }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-16 card">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                    <h2 class="text-xl font-semibold text-gray-600 mb-2">Aucun avis pour l'instant</h2>
                    <p class="text-gray-500 mb-6">Soyez le premier à partager votre expérience !</p>
                    {% if app.user %}
                        <a href="{{ path('avis_ajouter') }}" class="btn-primary">Laisser mon avis</a>
                    {% else %}
                        <a href="{{ path('connexion', {redirect: '/vos-retours/ajouter'}) }}" class="btn-primary">Se connecter</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}
